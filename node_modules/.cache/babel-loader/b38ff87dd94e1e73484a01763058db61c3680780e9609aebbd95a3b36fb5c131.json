{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ADMIN\\\\OneDrive\\\\Documents\\\\FullStackApp\\\\Food-del\\\\frontend\\\\src\\\\context\\\\StoreContext.jsx\",\n  _s = $RefreshSig$();\nimport { createContext, useEffect, useState } from \"react\";\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const StoreContext = /*#__PURE__*/createContext({\n  cartItems: {},\n  food_list: [],\n  addToCart: () => {},\n  removeFromCart: () => {},\n  getTotalCartAmount: () => 0,\n  url: \"\",\n  token: \"\",\n  setToken: () => {}\n});\nconst StoreContextProvider = props => {\n  _s();\n  const [cartItems, setCartItems] = useState({});\n  const [token, setToken] = useState(\"\");\n  const [food_list, setFoodList] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const url = \"http://localhost:4000\";\n\n  // ✅ Safe add to cart\n  const addToCart = async itemId => {\n    try {\n      setCartItems(prev => ({\n        ...prev,\n        [itemId]: (prev[itemId] || 0) + 1\n      }));\n      if (token) {\n        await axios.post(`${url}/api/cart/add`, {\n          itemId\n        }, {\n          headers: {\n            token\n          }\n        });\n      }\n    } catch (err) {\n      console.error(\"Failed to add to cart:\", err);\n      // Revert if API call fails\n      setCartItems(prev => ({\n        ...prev,\n        [itemId]: Math.max(0, (prev[itemId] || 0) - 1)\n      }));\n    }\n  };\n\n  // ✅ Safe remove from cart\n  const removeFromCart = async itemId => {\n    try {\n      setCartItems(prev => ({\n        ...prev,\n        [itemId]: Math.max(0, (prev[itemId] || 0) - 1)\n      }));\n      if (token) {\n        await axios.post(`${url}/api/cart/remove`, {\n          itemId\n        }, {\n          headers: {\n            token\n          }\n        });\n      }\n    } catch (err) {\n      console.error(\"Failed to remove from cart:\", err);\n      // Revert if API call fails\n      setCartItems(prev => ({\n        ...prev,\n        [itemId]: (prev[itemId] || 0) + 1\n      }));\n    }\n  };\n\n  // ✅ Safe total calculation\n  const getTotalCartAmount = () => {\n    return Object.entries(cartItems).reduce((total, [itemId, quantity]) => {\n      if (quantity > 0) {\n        const itemInfo = food_list.find(product => {\n          var _product$_id;\n          return (product === null || product === void 0 ? void 0 : (_product$_id = product._id) === null || _product$_id === void 0 ? void 0 : _product$_id.toString()) === itemId;\n        });\n        return total + ((itemInfo === null || itemInfo === void 0 ? void 0 : itemInfo.price) || 0) * quantity;\n      }\n      return total;\n    }, 0);\n  };\n\n  // ✅ Fetch data with error handling\n  const fetchFoodList = async () => {\n    try {\n      const response = await axios.get(`${url}/api/food/list`);\n      setFoodList(response.data.data || []);\n    } catch (err) {\n      console.error(\"Failed to fetch food list:\", err);\n      setError(\"Failed to load menu items\");\n      setFoodList([]);\n    }\n  };\n\n  // ✅ Load cart with error handling\n  const loadCartData = async userToken => {\n    try {\n      const response = await axios.post(`${url}/api/cart/get`, {}, {\n        headers: {\n          token: userToken\n        }\n      });\n      setCartItems(response.data.cartData || {});\n    } catch (err) {\n      console.error(\"Failed to load cart:\", err);\n      setCartItems({});\n    }\n  };\n  useEffect(() => {\n    async function loadData() {\n      try {\n        await fetchFoodList();\n        const storedToken = localStorage.getItem(\"token\");\n        if (storedToken) {\n          setToken(storedToken);\n          await loadCartData(storedToken);\n        }\n      } catch (err) {\n        console.error(\"Initialization error:\", err);\n        setError(\"Failed to initialize application\");\n      } finally {\n        setLoading(false);\n      }\n    }\n    loadData();\n  }, []);\n  const contextValue = {\n    food_list,\n    cartItems: cartItems || {},\n    addToCart,\n    removeFromCart,\n    getTotalCartAmount,\n    url,\n    token,\n    setToken,\n    loading,\n    error\n  };\n  return /*#__PURE__*/_jsxDEV(StoreContext.Provider, {\n    value: contextValue,\n    children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading\",\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 9\n    }, this) : error ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 9\n    }, this) : props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 147,\n    columnNumber: 5\n  }, this);\n};\n_s(StoreContextProvider, \"NLK9CSwXsBdjpT/bny8nqE8XyTk=\");\n_c = StoreContextProvider;\nexport default StoreContextProvider;\nvar _c;\n$RefreshReg$(_c, \"StoreContextProvider\");","map":{"version":3,"names":["createContext","useEffect","useState","axios","jsxDEV","_jsxDEV","StoreContext","cartItems","food_list","addToCart","removeFromCart","getTotalCartAmount","url","token","setToken","StoreContextProvider","props","_s","setCartItems","setFoodList","loading","setLoading","error","setError","itemId","prev","post","headers","err","console","Math","max","Object","entries","reduce","total","quantity","itemInfo","find","product","_product$_id","_id","toString","price","fetchFoodList","response","get","data","loadCartData","userToken","cartData","loadData","storedToken","localStorage","getItem","contextValue","Provider","value","children","className","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/ADMIN/OneDrive/Documents/FullStackApp/Food-del/frontend/src/context/StoreContext.jsx"],"sourcesContent":["import { createContext, useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nexport const StoreContext = createContext({\r\n  cartItems: {},\r\n  food_list: [],\r\n  addToCart: () => {},\r\n  removeFromCart: () => {},\r\n  getTotalCartAmount: () => 0,\r\n  url: \"\",\r\n  token: \"\",\r\n  setToken: () => {}\r\n});\r\n\r\nconst StoreContextProvider = (props) => {\r\n  const [cartItems, setCartItems] = useState({});\r\n  const [token, setToken] = useState(\"\");\r\n  const [food_list, setFoodList] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  const url = \"http://localhost:4000\";\r\n\r\n  // ✅ Safe add to cart\r\n  const addToCart = async (itemId) => {\r\n    try {\r\n      setCartItems((prev) => ({\r\n        ...prev,\r\n        [itemId]: (prev[itemId] || 0) + 1\r\n      }));\r\n\r\n      if (token) {\r\n        await axios.post(\r\n          `${url}/api/cart/add`,\r\n          { itemId },\r\n          { headers: { token } }\r\n        );\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Failed to add to cart:\", err);\r\n      // Revert if API call fails\r\n      setCartItems((prev) => ({\r\n        ...prev,\r\n        [itemId]: Math.max(0, (prev[itemId] || 0) - 1)\r\n      }));\r\n    }\r\n  };\r\n\r\n  // ✅ Safe remove from cart\r\n  const removeFromCart = async (itemId) => {\r\n    try {\r\n      setCartItems((prev) => ({\r\n        ...prev,\r\n        [itemId]: Math.max(0, (prev[itemId] || 0) - 1)\r\n      }));\r\n\r\n      if (token) {\r\n        await axios.post(\r\n          `${url}/api/cart/remove`,\r\n          { itemId },\r\n          { headers: { token } }\r\n        );\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Failed to remove from cart:\", err);\r\n      // Revert if API call fails\r\n      setCartItems((prev) => ({\r\n        ...prev,\r\n        [itemId]: (prev[itemId] || 0) + 1\r\n      }));\r\n    }\r\n  };\r\n\r\n  // ✅ Safe total calculation\r\n  const getTotalCartAmount = () => {\r\n    return Object.entries(cartItems).reduce((total, [itemId, quantity]) => {\r\n      if (quantity > 0) {\r\n        const itemInfo = food_list.find(\r\n          (product) => product?._id?.toString() === itemId\r\n        );\r\n        return total + (itemInfo?.price || 0) * quantity;\r\n      }\r\n      return total;\r\n    }, 0);\r\n  };\r\n\r\n  // ✅ Fetch data with error handling\r\n  const fetchFoodList = async () => {\r\n    try {\r\n      const response = await axios.get(`${url}/api/food/list`);\r\n      setFoodList(response.data.data || []);\r\n    } catch (err) {\r\n      console.error(\"Failed to fetch food list:\", err);\r\n      setError(\"Failed to load menu items\");\r\n      setFoodList([]);\r\n    }\r\n  };\r\n\r\n  // ✅ Load cart with error handling\r\n  const loadCartData = async (userToken) => {\r\n    try {\r\n      const response = await axios.post(\r\n        `${url}/api/cart/get`,\r\n        {},\r\n        { headers: { token: userToken } }\r\n      );\r\n      setCartItems(response.data.cartData || {});\r\n    } catch (err) {\r\n      console.error(\"Failed to load cart:\", err);\r\n      setCartItems({});\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    async function loadData() {\r\n      try {\r\n        await fetchFoodList();\r\n        const storedToken = localStorage.getItem(\"token\");\r\n        if (storedToken) {\r\n          setToken(storedToken);\r\n          await loadCartData(storedToken);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Initialization error:\", err);\r\n        setError(\"Failed to initialize application\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    loadData();\r\n  }, []);\r\n\r\n  const contextValue = {\r\n    food_list,\r\n    cartItems: cartItems || {},\r\n    addToCart,\r\n    removeFromCart,\r\n    getTotalCartAmount,\r\n    url,\r\n    token,\r\n    setToken,\r\n    loading,\r\n    error\r\n  };\r\n\r\n  return (\r\n    <StoreContext.Provider value={contextValue}>\r\n      {loading ? (\r\n        <div className=\"loading\">Loading...</div>\r\n      ) : error ? (\r\n        <div className=\"error\">{error}</div>\r\n      ) : (\r\n        props.children\r\n      )}\r\n    </StoreContext.Provider>\r\n  );\r\n};\r\n\r\nexport default StoreContextProvider;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}